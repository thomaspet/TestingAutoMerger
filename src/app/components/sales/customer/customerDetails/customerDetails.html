<uni-toolbar
    *ngIf="!modalMode"
    [config]="toolbarconfig"
    [saveactions]="saveactions"
    [subheads]="toolbarSubheads"
    [commentsConfig]="commentsConfig"
    [selectConfig]="selectConfig"
    [validationMessages]="toolbarStatusValidation"
    (selectValueChanged)="numberSeriesChange($event)">
</uni-toolbar>

<section class="customer-details application">
    <uni-tabs [tabs]="tabs" (activeIndexChange)="showTab($event)"></uni-tabs>

    <!-- Details tab -->
    <ng-template [ngIf]="activeTabIndex === 0">
        <uni-form
            [config]="config$"
            [fields]="fields$"
            [model]="customer$"
            (errorEvent)="onFormError($event)"
            (changeEvent)="onChange($event)">
        </uni-form>

        <ng-template [ngIf]="(customer$ | async)?.ID">
            <article class="collapsable" [ngClass]="{'-is-open': showSellerSection}">
                <h4 (click)="showSellerSection = !showSellerSection">Selgere</h4>
                <div class="collapsable-content">
                    <seller-links
                        [parent]="(customer$ | async)"
                        (sellerChanged)="onChange($event)"
                        (deleted)="onSellerLinkDeleted($event)">
                    </seller-links>
                </div>
            </article>

            <article class="collapsable" [ngClass]="{'-is-open': showContactSection}">
                <h4 (click)="showContactSection = !showContactSection">Kontakter</h4>
                <div class="collapsable-content">
                    <contacts
                        [parentBusinessRelation]="(customer$ | async)?.Info"
                        (contactChanged)="onContactChanged($event)">
                    </contacts>
                </div>
            </article>
        </ng-template>

        <article class="collapsable" [ngClass]="{'-is-open': showReminderSection}">
            <h4 (click)="showReminderSection = !showReminderSection">Purring</h4>
            <div class="collapsable-content">
                <reminder-settings
                    [settings]="(customer$ | async)?.CustomerInvoiceReminderSettings">
                </reminder-settings>
            </div>
        </article>
    </ng-template>

    <!-- Reconciliation tab -->
    <section *ngIf="activeTabIndex === 1" class="uni-container">
        <ledger-account-reconciliation
            [customerID]="(customer$ | async)?.ID">
        </ledger-account-reconciliation>
    </section>

    <!-- Products sold tab -->
    <customer-products-sold *ngIf="activeTabIndex === 2"
        [customerID]="(customer$ | async)?.ID">
    </customer-products-sold>

    <!-- Attachments tab -->
    <section *ngIf="activeTabIndex === 3" class="uni-container">
        <uni-attachments
            id="attachments"
            [entity]="'Customer'"
            [entityID]="(customer$ | async)?.ID">
        </uni-attachments>
    </section>

    <!-- Company tab -->
    <subcompanycomponent
        [hidden]="activeTabIndex !== 4"
        [customer]="customer$"
        (change)="onSubCompanyChange($event)">
    </subcompanycomponent>

    <!-- TOF tabs  -->
    <section *ngIf="showReportWithID" class="uni-container">
        <uni-query-read-only
            [queryDefinitionID]="showReportWithID"
            [customerID]="(customer$ | async)?.ID"
            [externalID]="(customer$ | async)?.ID"
            [projectID]="(customer$ | async)?.Dimensions?.ProjectID || 0">
        </uni-query-read-only>
    </section>

</section>

<uni-save *ngIf="modalMode" [actions]="saveactions" class="fixed-position uni_save_modal_mode"></uni-save>
