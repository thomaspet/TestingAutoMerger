<uni-toolbar
    [config]="toolbarconfig"
    [saveactions]="saveactions"
    [subheads]="toolbarSubheads"
    [commentsConfig]="commentsConfig"
    [selectConfig]="selectConfig"
    [validationMessages]="toolbarStatusValidation"
    (selectValueChanged)="numberSeriesChange($event)">
</uni-toolbar>

<section class="customer-details application">
    <uni-tabs [tabs]="tabs" [(activeIndex)]="activeTabIndex" (tabClick)="showTab()"></uni-tabs>

    <!-- Details tab -->
    <ng-template [ngIf]="activeTabIndex === 0">
        <uni-form
            [config]="config$"
            [fields]="fields$"
            [model]="customer$"
            (changeEvent)="onChange($event)"
            (errorEvent)="onError($event)">
        </uni-form>

        <ng-template [ngIf]="(customer$ | async)?.ID">
            <article class="collapsable" [ngClass]="{'-is-open': showSellerSection}">
                <h4 (click)="showSellerSection = !showSellerSection">Selgere</h4>
                <div class="collapsable-content">
                    <seller-links style="width: 100%;"
                        [entity]="(customer$ | async)"
                        (entityChange)="onSellersChange($event)">
                    </seller-links>
                </div>
            </article>

            <article class="collapsable" [ngClass]="{'-is-open': showContactSection}">
                <h4 (click)="showContactSection = !showContactSection">Kontakter</h4>
                <div class="collapsable-content">
                    <contacts
                        [parentBusinessRelation]="(customer$ | async)?.Info"
                        (parentBusinessRelationChange)="onContactsChange()">
                    </contacts>
                </div>
            </article>
        </ng-template>

        <article class="collapsable" [ngClass]="{'-is-open': showReminderSection}">
            <h4 (click)="showReminderSection = !showReminderSection">Purring</h4>
            <div class="collapsable-content">
                <reminder-settings
                    [reminderSettings]="(customer$ | async)?.CustomerInvoiceReminderSettings"
                    (reminderSettingsChange)="onChange($event)">
                </reminder-settings>
            </div>
        </article>
    </ng-template>

    <!-- Reconciliation tab -->
    <section *ngIf="activeTabIndex === 1" class="uni-container customer-post-post-view">
        <div style="display: flex;">
            <uni-tabs
                [tabs]="postposttabs"
                (tabClick)="onPostpostFilterClick($event)">
            </uni-tabs>
            <button class="good" (click)="goToPostpost()">Rediger</button>
        </div>

        <ledger-account-reconciliation style="font-size: .9rem"
            [customerBankAccounts]="(customer$ | async)?.Info?.BankAccounts"
            [disablePaymentToField]="true"
            [accountNumber]="(customer$ | async)?.CustomerNumber"
            [showRowSelect]="false"
            [hideHeader]="true"
            [customerID]="(customer$ | async)?.ID">
        </ledger-account-reconciliation>
    </section>

    <!-- Products sold tab -->
    <customer-products-sold *ngIf="activeTabIndex === 2"
        [customerID]="(customer$ | async)?.ID">
    </customer-products-sold>

    <!-- Attachments tab -->
    <section *ngIf="activeTabIndex === 3" class="uni-container">
        <uni-attachments
            id="attachments"
            [entity]="'Customer'"
            [entityID]="(customer$ | async)?.ID">
        </uni-attachments>
    </section>

    <!-- Company tab -->
    <subcompanycomponent
        [hidden]="activeTabIndex !== 4"
        [customer]="customer$"
        (change)="onSubCompanyChange($event)">
    </subcompanycomponent>

    <!-- TOF tabs  -->
    <section *ngIf="showReportWithID" class="uni-container">
        <uni-query-read-only
            [queryDefinitionID]="showReportWithID"
            [customerID]="(customer$ | async)?.ID"
            [externalID]="(customer$ | async)?.ID"
            [projectID]="(customer$ | async)?.Dimensions?.ProjectID || 0">
        </uni-query-read-only>
    </section>

</section>
