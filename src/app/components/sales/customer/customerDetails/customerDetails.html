<uni-toolbar
    *ngIf="!modalMode"
    [config]="toolbarconfig"
    [saveactions]="saveactions"
    [commentsConfig]="commentsConfig"
    [selectConfig]="selectConfig"
    (selectValueChanged)="numberSeriesChange($event)">
</uni-toolbar>

<uni-poster [widgets]="customerWidgets" *ngIf="customerWidgets && (customer$|async)?.ID"></uni-poster>

<header class="customer_poster">

    <div class="horizontal_nav" *ngIf="(customer$|async)?.ID">
        <ul>
            <li>
                <a [class]="activeTab === 'details' ? 'router-link-active' : ''"
                   (click)="showTab('details')">
                   Detaljer
                </a>
            </li>
            <li>
                <a [class]="activeTab === 'reconciliation' ? 'router-link-active' : ''"
                   (click)="showTab('reconciliation')">
                    Ã…pne poster
                </a>
            </li>
            <li>
                <a [class]="activeTab === 'productssold' ? 'router-link-active' : ''"
                   (click)="showTab('productssold')">
                    Produkter solgt
                </a>
            </li>
            <li>
                <a [class]="activeTab === 'attachments' ? 'router-link-active' : ''"
                   (click)="showTab('attachments')">
                    Dokumenter
                </a>
            </li>
            <li *ngFor="let link of reportLinks">
                <a
                        [class]="activeTab === 'report' && showReportWithID == link.id ? 'router-link-active' : ''"
                        (click)="showTab('report', link.id)"
                >{{link.name}}</a>
            </li>
        </ul>
    </div>

</header>
<section class="customer-details application">
    <uni-form *ngIf="activeTab === 'details'"
              [config]="config$"
              [fields]="fields$"
              [model]="customer$"
              (changeEvent)="onChange($event)">
    </uni-form>
    <article class="collapsable" [ngClass]="{'-is-open': showSellerSection}" *ngIf="activeTab === 'details' && (customer$|async)?.ID">
        <h4 (click)="showSellerSection = !showSellerSection">Selgere</h4>
        <div class="collapsable-content">
            <seller-links
                [parent]="(customer$ | async)"
                (sellerChanged)="onChange($event)"
                (mainSellerSet)="onMainSellerSet($event)"
                (deleted)="onSellerLinkDeleted($event)">
            </seller-links>
        </div>
    </article>
    <article class="collapsable" [ngClass]="{'-is-open': showContactSection}" *ngIf="activeTab === 'details' && (customer$|async)?.ID">
        <h4 (click)="showContactSection = !showContactSection">Kontakter</h4>
        <div class="collapsable-content">
            <contacts
                [parentBusinessRelation]="(customer$ | async)?.Info"
                (contactChanged)="onContactChanged($event)">
            </contacts>
        </div>
    </article>
    <article class="collapsable" [ngClass]="{'-is-open': showReminderSection}" *ngIf="activeTab === 'details'">
        <h4 (click)="showReminderSection = !showReminderSection">Purring</h4>
        <div class="collapsable-content">
            <reminder-settings
                [settings]="(customer$ | async)?.CustomerInvoiceReminderSettings">
            </reminder-settings>
        </div>
    </article>
    <ledger-account-reconciliation *ngIf="activeTab === 'reconciliation'"
            [customerID]="(customer$ | async)?.ID">
    </ledger-account-reconciliation>
    <customer-products-sold *ngIf="activeTab === 'productssold'"
            [customerID]="(customer$ | async)?.ID">
    </customer-products-sold>
    <uni-attachments *ngIf="activeTab === 'attachments'"
        id="attachments"
        [entity]="'Customer'"
        [entityID]="(customer$ | async)?.ID"
        [hideLabel]="true">
    </uni-attachments>
    <div *ngFor="let link of reportLinks">
        <uni-query-read-only
                *ngIf="showReportWithID === link.id"
                [ngClass]="{'hidden': showReportWithID != link.id}"
                [queryDefinitionID]="link.id"
                [customerID]="(customer$ | async)?.ID"
                [externalID]="(customer$ | async)?.ID"
                [projectID]="(customer$ | async)?.Dimensions?.ProjectID || 0">
        </uni-query-read-only>
    </div>
</section>

<uni-save *ngIf="modalMode" [actions]="saveactions" class="uni_save_modal_mode"></uni-save>
