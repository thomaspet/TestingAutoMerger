<uni-toolbar
    [config]="toolbarconfig"
    [saveactions]="saveActions"
    [statustrack]="toolbarStatus"
    [commentsConfig]="commentsConfig"
    [selectConfig]="selectConfig"
    (selectValueChanged)="numberSeriesChange($event)">
</uni-toolbar>

<section class="application">
    <uni-tof-head
        [readonly]="readonly"
        [entityName]="'CustomerInvoice'"
        [data]="invoice"
        [currencyCodes]="currencyCodes"
        [projects]="projects"
        [departments]="departments"
        [sellers]="sellers"
        [contacts]="invoice?.Customer?.Info?.Contacts || []"
        [companySettings]="companySettings"
        [dimensionTypes]="dimensionTypes"
        [distributionPlans]="distributionPlans"
        [reports]="reports"
        [paymentInfoTypes]="paymentInfoTypes"
        [currentUser]="currentUser"
        [canSendEHF]="canSendEHF"
        (errorEvent)="onErrorEvent($event)"
        (dataChange)="onInvoiceChange($event)"
        (dimensionChange)="onDimensionChange($event)">
    </uni-tof-head>
 
    <section class="tradeitem-container">
        <uni-tradeitem-table
            *ngIf="invoice"
            [configStoreKey]="'sales.invoice.tradeitemTable'"
            [readonly]="readonly || readonlyDraft"
            [projects]="projects"
            [departments]="departments"
            [vatTypes]="vatTypes"
            [vatDate]="invoice.InvoiceDate"
            [deliveryDate]="invoice.DeliveryDate"
            [(items)]="invoiceItems"
            [dimensionTypes]="dimensionTypes"
            [currencyCodeID]="currencyCodeID"
            [currencyExchangeRate]="currencyExchangeRate"
            [defaultTradeItem]="newInvoiceItem"
            (itemsChange)="onTradeItemsChange($event)">
        </uni-tradeitem-table>

        <section class="freetext-and-summary">
            <section *ngIf="invoice" class="freetext">
                <span>Fritekst</span>
                <textarea
                    [(ngModel)]="invoice.FreeTxt"
                    (change)="onFreetextChange()">
                </textarea>
            </section>

            <section class="tof-summary">
                <section class="currency-and-db">
                    <span>{{currencyInfo}}</span>
                    <span *ngIf="itemsSummaryData?.DekningsGrad">
                        DG: {{itemsSummaryData?.DekningsGrad | uninumberformat:'percent'}}%
                    </span>
                </section>

                <section class="vertical-summary" *ngIf="summaryLines?.length">
                    <section class="summary-line"
                        *ngFor="let summaryLine of summaryLines"
                        [ngClass]="{'total-sum': summaryLine.isTotalSum}">

                        <label>{{summaryLine.label}}</label>
                        <span>{{summaryLine.value}}</span>
                    </section>
                </section>
            </section>
        </section>
    </section>
</section>
