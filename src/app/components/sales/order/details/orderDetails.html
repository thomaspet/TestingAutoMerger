<uni-toolbar
    [config]="toolbarconfig"
    [saveactions]="saveActions"
    [commentsConfig]="commentsConfig"
    [selectConfig]="selectConfig"
    (selectValueChanged)="numberSeriesChange($event)">
</uni-toolbar>

<section class="application">
    <uni-tof-head
        [readonly]="readonly"
        [entityName]="'CustomerOrder'"
        [data]="order"
        [currencyCodes]="currencyCodes"
        [projects]="projects"
        [departments]="departments"
        [sellers]="sellers"
        [contacts]="order?.Customer?.Info?.Contacts || []"
        [dimensionTypes]="dimensionTypes"
        [distributionPlans]="distributionPlans"
        [reports]="reports"
        [paymentInfoTypes]="paymentInfoTypes"
        [currentUser]="currentUser"
        [canSendEHF]="canSendEHF"
        (dataChange)="onOrderChange($event)"
        (dimensionChange)="onDimensionChange($event)">
    </uni-tof-head>

    <section class="uni-container tradeitem-container">
        <header>Varelinjer
            <ng-container *ngIf="hoursOnOrderCount && hasTimetrackingAccess">
                <i class="material-icons notification_important icon-orange">notification_important</i>
                <span class="orderHours">
                    Du har <span class="boldHours">{{hoursOnOrderCount}}</span> timer knyttet til denne ordren
                    <span class="orderHours" *ngIf="nonTransferredHoursOnOrderCount">({{nonTransferredHoursOnOrderCount}} ikke overført)</span>
                    <a class="transferHours" (click)="openModal()">Vis/overfør timer</a>
                </span>
            </ng-container>
        </header>

        <section class="tradeitem-container">
            <uni-tradeitem-table
                *ngIf="order"
                [configStoreKey]="'sales.order.tradeitemTable'"
                [defaultTradeItem]="newOrderItem"
                [vatDate]="order.OrderDate"
                [vatTypes]="vatTypes"
                [projects]="projects"
                [departments]="departments"
                [(items)]="orderItems"
                [dimensionTypes]="dimensionTypes"
                [currencyCodeID]="currencyCodeID"
                [currencyExchangeRate]="currencyExchangeRate"
                (itemsChange)="onTradeItemsChange()">
            </uni-tradeitem-table>

            <section class="freetext-and-summary">
                <section *ngIf="order" class="freetext">
                    <span>Fritekst</span>
                    <textarea
                        [(ngModel)]="order.FreeTxt"
                        (change)="onFreetextChange()">
                    </textarea>
                </section>

                <section class="tof-summary">
                    <section class="currency-and-db">
                        <span>{{currencyInfo}}</span>
                        <span *ngIf="itemsSummaryData?.DekningsGrad">
                            DG: {{itemsSummaryData?.DekningsGrad | uninumberformat:'percent'}}%
                        </span>
                    </section>

                    <section class="vertical-summary" *ngIf="summaryLines?.length">
                        <section class="summary-line"
                            *ngFor="let summaryLine of summaryLines"
                            [ngClass]="{'total-sum': summaryLine.isTotalSum}">

                            <label>{{summaryLine.label}}</label>
                            <span>{{summaryLine.value}}</span>
                        </section>
                    </section>
                </section>
            </section>
        </section>
    </section>
</section>
