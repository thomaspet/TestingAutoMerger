<article class="tof-head">
    <section class="uni-container customer-card">
        <header style="font-weight: 500; border-bottom: 1px solid var(--border-color); padding: 1.5rem 1rem;">
            Kunde{{customers?.length > 1 ? "r" : ""}}
            <button 
                *ngIf="entityName === 'CustomerInvoice' && (customers?.length <= 1 || !customers) && (data?.StatusCode === 42001 || data?.StatusCode === null)"
                style="margin-left: auto; padding-right: 0; "
                class="tertiary c2a" (click)="addMultipleCustomer()">
                + Legg til flere
            </button>
        </header>

        <tof-customer-card
            *ngIf="!customers?.length || customers?.length === 1"
            [readonly]="readonly"
            [entity]="data"
            [entityType]="entityName"
            [distributions]="distributions"
            (entityChange)="onDataChange($event)"
            (keydown.tab)="focusDetailsForm($event)">
        </tof-customer-card>

        <tof-customer-list
            *ngIf="customers?.length > 1"
            [entities]="customers"
            (editCustomerList)="addMultipleCustomer()"
            (keydown.tab)="focusDetailsForm($event)">
        >
        </tof-customer-list>

        <div class="required-dimension" *ngIf="validationMessage?.Level === 30">
            <i class="material-icons bad">error</i>
            {{validationMessage.Message}}
        </div>
    </section>

    <section class="uni-container tof-forms">
        <uni-tabs class="scoped"
            [activeIndex]="0"
            [tabs]="tabs"
            (tabClick)="activeTab = $event.value">
        </uni-tabs>

        <uni-recurring-invoice-settings-view
            *ngIf="activeTab === 'settings'"
            [entity]="data"
            (entityChange)="onDataChange($event)"
            [entityType]="entityName">
        </uni-recurring-invoice-settings-view>

        <tof-details-form
            *ngIf="activeTab === 'details'"
            [entity]="data"
            (entityChange)="onDataChange($event)"
            (dimensionChange)="dimensionChange.emit($event)"
            (errorEvent)="errorEvent.emit($event)"
            [entityType]="entityName"
            [readonly]="readonly"
            [multipleCustomers]="customers?.length > 1"
            [currencyCodes]="currencyCodes"
            [projects]="projects"
            [departments]="departments"
            [contacts]="contacts"
            [companySettings]="companySettings">
        </tof-details-form>

        <tof-delivery-form
            *ngIf="activeTab === 'delivery'"
            [entity]="data"
            (entityChange)="onDataChange($event)"
            [entityType]="entityName"
            [readonly]="readonly"
            [multipleCustomers]="customers?.length > 1"
            [paymentInfoTypes]="paymentInfoTypes">
        </tof-delivery-form>

        <section class="comment-input" *ngIf="activeTab === 'comment'">
            <label class="uni-label" *ngIf="data">
                <span>
                    <i class="material-icons">info_outline</i>
                    Kommentar legges over varelinjetabell på fakturablanketten
                </span>

                <textarea [(ngModel)]="data.Comment" (change)="onDataChange()" placeholder="Kommentar"></textarea>
            </label>
        </section>

        <section class="tof-sellers" *ngIf="activeTab === 'sellers'">
            <tof-sellers
                [readonly]="isReadOnly()"
                [sellers]="sellers"
                [(data)]="data"
                (dataChange)="dataChange.emit(data)">
            </tof-sellers>
        </section>

        <section class="tof-attachments" *ngIf="activeTab === 'attachments'">
            <label class="uni-label" *ngIf="!data?.ID">
                <span *ngIf="entityName == 'CustomerInvoice' || entityName === 'RecurringInvoice'">
                    <i class="material-icons">info_outline</i>
                    Du må lagre faktura som kladd før du kan legge til dokumenter.
                </span>
                <span *ngIf="entityName == 'CustomerOrder'">
                    <i class="material-icons">info_outline</i>
                    Du må lagre ordre som kladd eller registrere ordre før du kan legge til dokumenter.
                </span>
                <span *ngIf="entityName == 'CustomerQuote'">
                    <i class="material-icons">info_outline</i>
                    Du må lagre tilbud som kladd eller registrere tilbud før du kan legge til dokumenter.
                </span>
            </label>

            <uni-attachments *ngIf="data?.ID"
                id="attachments"
                [entity]="entityName"
                [entityID]="data?.ID"
                [tooltip]="'Maks total vedleggstørrelse er 30MB for e-post og 50MB for EHF'"
                [showInfoBox]="true"
                (selectedFileSize)="onSelectedFileSize($event)">
            </uni-attachments>
        </section>

        <uni-dimension-view
            *ngIf="activeTab === 'dimensions'"
            (entityChange)="onDataChange($event)"
            (dimensionChange)="dimensionChange.emit($event)"
            [dimensionTypes]="dimensionTypes"
            [entity]="data"
            [entityType]="entityName">
        </uni-dimension-view>

        <tof-distribution-form
            *ngIf="activeTab === 'distribution'"
            [distributionPlans]="distributionPlans"
            [reports]="reports"
            [entity]="data"
            [entityType]="entityName"
            [companySettings]="companySettings"
            (entityChange)="onDataChange($event)">
        </tof-distribution-form>

        <section class="tof-reminders" *ngIf="activeTab === 'reminders'">
            <invoice-reminders [customerInvoice]="data"></invoice-reminders>
        </section>
    </section>

</article>
