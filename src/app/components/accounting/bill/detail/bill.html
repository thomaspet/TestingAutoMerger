<uni-toolbar [config]="toolbarConfig"
             [saveactions]="actions"
             [commentsConfig]="commentsConfig"
             class="no-print">
</uni-toolbar>

<section class="uni-split-view-container" [attr.aria-busy]="loadingForm">
    <section class="left-side">

        <uni-form
            [attr.aria-busy]="loadingForm"
            [config]="formConfig$"
            [fields]="fields$"
            [model]="current"
            (readyEvent)="onFormReady($event)"
            (changeEvent)="onFormChange($event)"
            (inputEvent)="onFormInput($event)"
            (focusEvent)="onFocusEvent($event)">
        </uni-form>

        <section class="tabs">
            <button (click)="setTab('posts')" [ngClass]="{'active': currentTab === 'posts'}">
                Kontering
            </button>

            <button (click)="setTab('history')" [ngClass]="{'active': currentTab === 'history'}">
                Leverand√∏rhistorikk
            </button>
        </section>

        <section class="journal-entry" *ngIf="currentTab === 'posts'">
            <journal-entry-manual
                *ngIf="(current | async)"
                [mode]="2"
                [editmode]="false"
                [journalEntryID]="(current | async)?.JournalEntryID"
                [runAsSubComponent]="true"
                [singleRowMode]="true"
                [doValidateBalance]="false"
                [defaultRowData]="defaultRowData"
                (dataChanged)="onJournalEntryManualChange($event)"
                (dataLoaded)="onJournalEntryManualDataLoaded($event)">
            </journal-entry-manual>

            <table *ngIf="!(current | async)?.JournalEntry?.JournalEntryNumber" class="compact-summary">
                <tr>
                    <td>Differanse</td>
                    <td [class.warning]="sumRemainder" *ngIf="sumRemainder != null">{{ sumRemainder | unicurrency}} {{current?.CurrencyCode?.ShortCode}}</td>
                    <td *ngIf="sumRemainder == null">-</td>
                    <td>Sum Mva</td>
                    <td *ngIf="sumVat != null">{{ sumVat | unicurrency}} {{current?.CurrencyCode?.ShortCode}}</td>
                    <td *ngIf="sumVat == null">-</td>
                </tr>
                <tr *ngIf="current.CurrencyExchangeRate">
                    <td>Valutakurs: {{current.CurrencyExchangeRate}}</td>
                </tr>
            </table>

        </section>

        <section class="bill-history" *ngIf="currentTab === 'history'">
            <uni-bill-history
                [isActive]="true"
                [supplierID]="(current | async)?.SupplierID"
                [parentID]="(current | async)?.ID">
            </uni-bill-history>
        </section>

    </section>
    <section class="right-side journalentry-image-area">
        <legend>Dokument ({{this.files?.length || 0}})</legend>
        <uni-image
            [singleImage]="false"
            [uploadWithoutEntity]="!(current | async)?.ID"
            [fileIDs]="(current | async)?.ID ? [] : startUpFileID"
            [entity]="(current | async)?.ID ? 'SupplierInvoice' : ''"
            [entityID]="(current | async)?.ID"
            [size]="1200"
            [splitAllowed]="true"
            [rotateAllowed]="true"
            (fileListReady)="onFileListReady($event)"
            (imageDeleted)="onImageDeleted($event)"
            (imageClicked)="onImageClicked($event)"
            (useWord)="onUseWord($event)">
        </uni-image>
        <button *ngIf="!(current | async)?.ID" class="document_from_flow_button" (click)="openAddFileModal()"> Hent fra innboks</button>
    </section>

</section>
