<uni-toolbar
    [config]="toolbarConfig"
    [saveactions]="actions"
    [commentsConfig]="commentsConfig"
    class="no-print">
</uni-toolbar>

<section class="application">

    <section class="bill-left-side">

        <section class="uni-container">
            <header>Detaljer</header>
            <uni-form
                [config]="formConfig$"
                [fields]="fields$"
                [model]="current"
                (readyEvent)="onFormReady()"
                (changeEvent)="onFormChange($event)"
                (inputEvent)="onFormInput($event)"
                (focusEvent)="onFocusEvent($event)">
            </uni-form>
        </section>

        <section class="uni-container" style="margin-bottom: 0">
            <uni-tabs [tabs]="tabs" [(activeIndex)]="activeTabIndex"></uni-tabs>

            <ng-template [ngIf]="activeTabIndex === 0">
                <journal-entry-manual
                    *ngIf="(current | async)"
                    [mode]="2"
                    [editmode]="false"
                    [journalEntryID]="(current | async)?.JournalEntryID"
                    [runAsSubComponent]="true"
                    [singleRowMode]="true"
                    [doValidateBalance]="false"
                    (dataChanged)="onJournalEntryManualChange($event)"
                    (dataLoaded)="onJournalEntryManualDataLoaded($event)">
                </journal-entry-manual>

                <table *ngIf="!(current | async)?.JournalEntry?.JournalEntryNumber" class="compact-summary">
                    <tr>
                        <td>Differanse</td>
                        <td [class.warning]="sumRemainder" *ngIf="sumRemainder != null">{{ sumRemainder | unicurrency}} {{current?.CurrencyCode?.ShortCode}}</td>
                        <td *ngIf="sumRemainder == null">-</td>
                        <td>Sum Mva</td>
                        <td *ngIf="sumVat != null">{{ sumVat | unicurrency}} {{current?.CurrencyCode?.ShortCode}}</td>
                        <td *ngIf="sumVat == null">-</td>
                    </tr>
                    <tr *ngIf="current.CurrencyExchangeRate">
                        <td>Valutakurs: {{current.CurrencyExchangeRate}}</td>
                    </tr>
                </table>

            </ng-template>

            <uni-bill-previous
                *ngIf="activeTabIndex === 1"
                [supplierID]="(current | async)?.SupplierID"
                [supplierInvoiceID]="(current | async)?.ID">
            </uni-bill-previous>                
    
            <uni-bill-history
                *ngIf="activeTabIndex === 2"
                [supplierID]="(current | async)?.SupplierID"
                [supplierInvoiceID]="(current | async)?.ID">
            </uni-bill-history>                

        </section>
    </section>

    <section class="bill-right-side uni-container">
        <header>Dokument ({{this.files?.length || 0}})</header>
        <uni-image
            [singleImage]="false"
            [uploadWithoutEntity]="!(current | async)?.ID"
            [fileIDs]="(current | async)?.ID ? [] : startUpFileID"
            [entity]="'SupplierInvoice'"
            [entityID]="(current | async)?.ID"
            [size]="1200"
            [splitAllowed]="true"
            [rotateAllowed]="true"
            (fileListReady)="onFileListReady($event)"
            (imageDeleted)="onImageDeleted($event)"
            (imageUnlinked)="imageUnlinked($event)"
            (imageClicked)="onImageClicked($event)"
            (useWord)="onUseWord($event)">
        </uni-image>
        <button *ngIf="!(current | async)?.ID" class="good document_from_flow_button" (click)="openAddFileModal()"> Hent fra innboks</button>
    </section>

</section>
