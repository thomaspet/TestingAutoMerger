<uni-toolbar
    [config]="toolbarConfig"
    [saveactions]="actions"
    [commentsConfig]="commentsConfig"
    [customStatus]="paymentStatusIndicator"
    [showFullStatustrack]="true"
    class="no-print">
</uni-toolbar>

<section class="application">
    <section class="bill-left-side">
        <section class="uni-container">
            <uni-tabs class="scoped"
                [tabs]="detailsTabs"
                [(activeIndex)]="detailsTabIndex"
                (activeIndexChange)="onDetailsTabClick($event)">
            </uni-tabs>

            <label class="supplier-label uni-label label-left" *ngIf="detailsTabIndex === 0">
                <span>Leverand√∏r</span>
                <autocomplete
                    class="customer-select"
                    (keydown.tab)="onAutocompleteTab()"
                    [options]="autocompleteOptions"
                    [readonly]="supplierIsReadOnly"
                    [value]="(current | async).Supplier"
                    (valueChange)="newSupplierSelected($event)">
                </autocomplete>
            </label>

            <uni-form
                *ngIf="detailsTabIndex === 0"
                [config]="{}"
                [fields]="fields$"
                [model]="current"
                (readyEvent)="onFormReady()"
                (changeEvent)="onFormChange($event)"
                (inputEvent)="onFormInput($event)"
                (focusEvent)="onFocusEvent($event)">
            </uni-form>
            <section *ngIf="detailsTabIndex === 1" class="freetext-tab-view">
                <span>Fritekst</span>
                <textarea [(ngModel)]="currentFreeTxt" (keyup)="flagUnsavedChanged()" [attr.maxLength]="500"> </textarea>
            </section>
            <section class="mandatory-dimensions-validation-message">
                <span *ngIf="validationMessage?.Level === 30"><!--MissingRequiredDimensionsMessage - vises ikke-->
                    <i class="material-icons bad">error</i>
                    <span>{{validationMessage.Message}}</span>
                </span>
            </section>
        </section>

        <section class="uni-container" style="margin-bottom: 0">
            <uni-tabs class="scoped" [tabs]="tabs" [(activeIndex)]="activeTabIndex"></uni-tabs>

            <ng-template [ngIf]="activeTabIndex === 0">
                <journal-entry-manual
                    *ngIf="(current | async)"
                    [mode]="2"
                    [editmode]="false"
                    [journalEntryID]="(current | async)?.JournalEntryID"
                    [runAsSubComponent]="true"
                    [singleRowMode]="true"
                    [doValidateBalance]="false"
                    [orgNumber]="orgNumber"
                    [costAllocationData]="(costAllocationData$ | async)"
                    (dataChanged)="onJournalEntryManualChange($event)"
                    (dataLoaded)="onJournalEntryManualDataLoaded($event)">
                </journal-entry-manual>

                <table *ngIf="!(current | async)?.JournalEntry?.JournalEntryNumber" class="compact-summary">
                    <tr>
                        <td>Differanse</td>
                        <td [class.warning]="sumRemainder" *ngIf="sumRemainder != null">{{ sumRemainder | unicurrency}} {{current?.CurrencyCode?.ShortCode}}</td>
                        <td *ngIf="sumRemainder == null">-</td>
                        <td>Sum Mva</td>
                        <td *ngIf="sumVat != null">{{ sumVat | unicurrency}} {{current?.CurrencyCode?.ShortCode}}</td>
                        <td *ngIf="sumVat == null">-</td>
                    </tr>
                    <tr *ngIf="current.CurrencyExchangeRate">
                        <td>Valutakurs: {{current.CurrencyExchangeRate}}</td>
                    </tr>
                </table>

            </ng-template>

            <uni-bill-previous
                *ngIf="activeTabIndex === 1"
                [supplierID]="(current | async)?.SupplierID"
                [supplierInvoiceID]="(current | async)?.ID">
            </uni-bill-previous>

            <uni-bill-history
                *ngIf="activeTabIndex === 2"
                [supplierID]="(current | async)?.SupplierID"
                [supplierInvoiceID]="(current | async)?.ID">
            </uni-bill-history>

        </section>
    </section>

    <section class="bill-right-side uni-container">
        <section *ngIf="loadingFiles" class="bill-preview-spinner">
            <section class="spinner-container">
                <section class="spinner-container">
                    <mat-spinner [diameter]="40" class="c2a" ></mat-spinner>
                    <section class="spinner-text">Laster dokument</section>
                </section>
            </section>
        </section>

        <header>
            Dokument ({{files?.length || 0}})

            <span class="get-from-inbox" (click)="openAddFileModal()" role="button">
                <uni-icon [icon]="'download'"></uni-icon>
                Hent fra innboks
            </span>

            <label class="upload-input">
                <uni-icon [icon]="'upload'"></uni-icon>
                <span>Last opp</span>
                <input type="file" (change)="uniImage.onUploadInputChange($event)" />
            </label>
        </header>

        <uni-image #uniImage
            [hideUploadInput]="true"
            [singleImage]="false"
            [uploadWithoutEntity]="!(current | async)?.ID"
            [fileIDs]="(current | async)?.ID ? [] : startUpFileID"
            [entity]="'SupplierInvoice'"
            [entityID]="(current | async)?.ID"
            [size]="1200"
            [splitAllowed]="true"
            [rotateAllowed]="true"
            (fileListReady)="onFileListReady($event)"
            (imageDeleted)="onImageDeleted($event)"
            (imageUnlinked)="imageUnlinked($event)"
            (useWord)="onUseWord($event)"
            (busyLoadingFiles)="onBusyLoadingFiles($event)">
        </uni-image>
    </section>
</section>
