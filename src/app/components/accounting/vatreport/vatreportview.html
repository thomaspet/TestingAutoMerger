<uni-toolbar
    [config]="toolbarconfig"
    [saveactions]="actions"
    (statusSelectEvent)="setVatReportFromEvent($event)">
</uni-toolbar>

<section class="application">
    <section class="uni-container vatreport_poster">

        <article class="vatreport_poster_widget first">
            <dl class="vatreport_poster_details">
                <dt>Juridisk enhet</dt>
                <dd>{{companySettings?.OrganizationNumber | uninumberformat:'orgno'}}</dd>
                <dt *ngIf="companySettings?.CompanyBankAccount?.AccountNumber">Kontonr. for tilbakebetaling</dt>
                <dd *ngIf="companySettings?.CompanyBankAccount?.AccountNumber">{{companySettings?.CompanyBankAccount?.AccountNumber | uninumberformat:'bankacct'}}</dd>

                <dt>Status for periode</dt>
                <dd [className]="statusCodeClassName">{{statusCodePeriod}}</dd>
                <dt>Betalingsstatus</dt>
                <dd [className]="paymentStatus === 'Betalt' ? 'success' : paymentStatus === 'Sendt til betaling' ? 'inprogress' : paymentStatus === 'Ikke betalt' ? 'warn': ''">{{paymentStatus}}</dd>
            </dl>
        </article>

        <article class="vatreport_poster_widget two-up">
            <table class="vatreport_poster_figures" *ngIf="vatReportSummary?.length > 0" cellspacing="0" cellpadding="0">
                <tr *ngIf="vatReportSummary?.length > 0">
                    <th></th>
                    <th>Grunnlag</th>
                    <th>Avgift</th>
                </tr>
                <tr *ngFor="let summaryItem of vatReportSummary; let i = index;">
                    <th [attr.colspan]="summaryItem.VatCodeGroupName === 'Sum' ? 2 : 1">{{summaryItem.VatCodeGroupName}}</th>
                    <td class="currency" *ngIf="summaryItem.VatCodeGroupName !== 'Sum'">
                        <uni-tooltip
                            *ngIf="summaryItem.VatCodeGroupNo === 'A' && vatReportSummaryFromPreviousPeriods?.length > 0"
                            [text]="previousPeriodsHelpText">
                        </uni-tooltip>
                        <a *ngIf="summaryItem.HasTaxBasis && !isHistoricData"
                           href="#/accounting/transquery?showTaxBasisAmount={{summaryItem.HasTaxBasis}}&vatCodesAndAccountNumbers={{vatReportSummaryToVatCodeAndAccountNumbers(summaryItem)}}&vatFromDate={{currentVatReport?.TerminPeriod?.FromDate}}&vatToDate={{currentVatReport?.TerminPeriod?.ToDate}}&vatReportID={{currentVatReport?.ID}}"
                           [className]="summaryItem.SumTaxBasisAmount * -1 >= 0 ? 'positiveNumber' : 'negativeNumber'"
                        >
                            {{summaryItem.SumTaxBasisAmount * -1 | unicurrency:2}}
                        </a>
                        <span *ngIf="summaryItem.HasTaxBasis && isHistoricData"
                              [className]="summaryItem.SumTaxBasisAmount * -1 >= 0 ? 'positiveNumber' : 'negativeNumber'">
                            {{summaryItem.SumTaxBasisAmount * -1 | unicurrency:2}}
                        </span>
                    </td>
                    <td class="currency">
                        <a *ngIf="summaryItem.HasTaxAmount && !isHistoricData" href="#/accounting/transquery?showTaxBasisAmount={{summaryItem.HasTaxBasis}}&vatCodesAndAccountNumbers={{vatReportSummaryToVatCodeAndAccountNumbers(summaryItem)}}&vatFromDate={{currentVatReport?.TerminPeriod?.FromDate}}&vatToDate={{currentVatReport?.TerminPeriod?.ToDate}}&vatReportID={{currentVatReport?.ID}}"
                           [className]="summaryItem.SumVatAmount * -1 >= 0 ? 'positiveNumber' : 'negativeNumber'">
                            {{summaryItem.SumVatAmount * -1 | unicurrency:2}}
                        </a>
                        <span *ngIf="summaryItem.HasTaxAmount && isHistoricData"
                              [className]="summaryItem.SumVatAmount * -1 >= 0 ? 'positiveNumber' : 'negativeNumber'">
                            {{summaryItem.SumVatAmount * -1 | unicurrency:2}}
                        </span>
                    </td>
                </tr>

                <em *ngIf="isHistoricData">Historiske data (XML)</em>
            </table>
        </article>

        <article class="vatreport_poster_widget">
            <ul class="vatreport_poster_events">
                <li [className]="isExecuted() ? 'success' : 'warn'">
                    <i class="material-icons">{{isExecuted() ? 'check_circle' : 'error'}}</i>
                    <span>
                        {{ isExecuted() ? 'Kjørt' : 'Ikke kjørt' }}
                        <time *ngIf="currentVatReport.ExecutedDate">{{currentVatReport.ExecutedDate | date: 'dd.MM.yyyy HH:mm'}}</time>
                    </span>
                </li>
                <li [className]="isSent() ? 'success' : 'warn'">
                    <i class="material-icons">{{isSent() ? 'check_circle' : 'error'}}</i>
                    <span>
                        {{ isSent() ? 'Sendt inn' : 'Ikke sendt inn' }}
                        <time *ngIf="submittedDate">({{submittedDate | date: 'dd.MM.yyyy HH:mm'}})</time>
                    </span>
                </li>
                <li [className]="isApproved() ? 'success' : 'warn'">
                    <i class="material-icons">{{isApproved() ? 'check_circle' : 'error'}}</i>
                    <span>
                        {{ isSent() ? 'Godkjent' : 'Ikke godkjent' }}
                        <time *ngIf="approvedDate">({{approvedDate | date: 'dd.MM.yyyy HH:mm'}})</time>
                    </span>
                </li>
            </ul>
        </article>

    </section>
</section>

<create-corrected-vatreport-modal></create-corrected-vatreport-modal>

<section class="application">
    <uni-tabs [tabs]="tabs" [(activeIndex)]="activeTabIndex"></uni-tabs>

    <vatreport-checklist-view
        *ngIf="activeTabIndex === 0"
        [attr.aria-busy]="!reportMessages"
        [vatReportMessages]="reportMessages">
    </vatreport-checklist-view>

    <ng-template [ngIf]="activeTabIndex === 1">
        <vat-summary-per-post
            [attr.aria-busy]="!reportSummaryPerPost"
            [reportSummaryPerPost]="reportSummaryPerPost"
            [period]="currentVatReport?.TerminPeriod"
            [vatTypes]="vatTypes"
            [isHistoricData]="isHistoricData"
            [vatReportID]="currentVatReport.ID"
            [vatReportMessages]="reportMessages">
        </vat-summary-per-post>

        <div class="comment commentToSend">
            <label>Kommenter til Altinn</label>
            <textarea
                [formControl]="externalComment"
                [ngModel]="currentVatReport.Comment"
                [disabled]="currentVatReport?.ID == 0 || isSent()">
            </textarea>
        </div>

        <div class="comment internalComment">
            <label>Intern kommentar</label>
            <textarea
                [formControl]="internalComment"
                [ngModel]="currentVatReport.InternalComment"
                [disabled]="currentVatReport?.ID == 0">
            </textarea>
        </div>
    </ng-template>

    <vatreport-receipt-view
        *ngIf="activeTabIndex === 2 && this.currentVatReport.ExternalRefNo"
        [vatReport]="currentVatReport"
        [reportSummaryPerPost]="reportSummaryPerPost"
        (vatReportDidChange)="vatReportDidChange($event)">
    </vatreport-receipt-view>

    <vatreport-journal-entry
        *ngIf="activeTabIndex === 3"
        [vatReport]="currentVatReport">
    </vatreport-journal-entry>


</section>



