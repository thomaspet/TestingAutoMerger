<uni-toolbar [config]="toolbarconfig"></uni-toolbar>

<header class="poster">


<section class="vatreport_poster">

        <article class="vatreport_poster_widget">
            <dl class="vatreport_poster_details">
                <dt>Firmanavn</dt>
                <dd>{{companySettings?.CompanyName}}</dd>

                <dt>Juridisk enhet</dt>
                <dd>{{companySettings?.OrganizationNumber | uninumberformat:'orgno'}}</dd>

                <dt *ngIf="companySettings?.CompanyBankAccount?.AccountNumber">Kontonr. for tilbakebetaling</dt>
                <dd *ngIf="companySettings?.CompanyBankAccount?.AccountNumber">{{companySettings?.CompanyBankAccount?.AccountNumber | uninumberformat:'bankacct'}}</dd>
            </dl>
        </article>

        <article class="vatreport_poster_widget two-up">
            <table class="vatreport_poster_figures">
                <tr *ngIf="vatReportSummary?.length > 0">
                    <td></td>
                    <th>Grunnlag</th>
                    <th>Avgift</th>
                </tr>
                <tr *ngFor="let summaryItem of vatReportSummary">
                    <th>{{summaryItem.VatCodeGroupName}}</th>
                    <td class="currency">
                        <a *ngIf="summaryItem.HasTaxBasis && !isHistoricData" href="#/accounting/transquery/details;showTaxBasisAmount={{summaryItem.HasTaxBasis}};vatCodesAndAccountNumbers={{vatReportSummaryToVatCodeAndAccountNumbers(summaryItem)}};vatFromDate={{currentVatReport?.TerminPeriod.FromDate}};vatToDate={{currentVatReport?.TerminPeriod.ToDate}}">
                            {{summaryItem.SumTaxBasisAmount * -1 | unicurrency:2}}
                        </a>
                        <span *ngIf="summaryItem.HasTaxBasis && isHistoricData">{{summaryItem.SumTaxBasisAmount * -1 | unicurrency:2}}</span>
                    </td>
                    <td class="currency">
                        <a *ngIf="summaryItem.HasTaxAmount && !isHistoricData" href="#/accounting/transquery/details;showTaxBasisAmount={{summaryItem.HasTaxBasis}};vatCodesAndAccountNumbers={{vatReportSummaryToVatCodeAndAccountNumbers(summaryItem)}};vatFromDate={{currentVatReport?.TerminPeriod.FromDate}};vatToDate={{currentVatReport?.TerminPeriod.ToDate}}">
                            {{summaryItem.SumVatAmount * -1 | unicurrency:2}}
                        </a>
                        <span *ngIf="summaryItem.HasTaxAmount && isHistoricData">{{summaryItem.SumVatAmount * -1 | unicurrency:2}}</span>
                    </td>
                </tr>

                <em *ngIf="isHistoricData">Historiske data (XML)</em>
            </table>
        </article>

        <article class="vatreport_poster_widget">
            <ul class="vatreport_poster_events">
                <li [className]="isControlledWithoutWarnings() ? 'success' : 'warn'">
                    {{ isControlledWithoutWarnings() ? 'Automatisk kontroll ok' : 'Automatisk kontroll har advarsler' }}
                </li>
                <li [className]="isExecuted() ? 'success' : 'warn'">
                    {{ isExecuted() ? 'Kjørt' : 'Ikke kjørt' }}
                </li>
                <li [className]="isSent() ? 'success' : 'warn'">
                    {{ isSent() ? 'Sendt inn' : 'Ikke sendt inn' }}
                </li>
                <li [className]="isApproved() ? 'success' : 'warn'">
                    {{ isSent() ? 'Godkjent' : 'Ikke godkjent' }}
                </li>
            </ul>
        </article>

    </section>

    <div class="horizontal_nav">
        <ul>
            <li>
                <a (click)="showView = 'control'" [class.router-link-active]="showView == 'control'">Kontroll</a>
            </li>
            <li>
                <a (click)="showView = ''" [class.router-link-active]="showView == ''">MVA-melding</a>
            </li>
            <li *ngIf="isSent()">
                <a (click)="showView = 'receipt'" [class.router-link-active]="showView == 'receipt'">Altinn, kvittering/tilbakemelding</a>
            </li>
            <li *ngIf="currentVatReport?.JournalEntryID">
                <a (click)="showView = 'journal'" [class.router-link-active]="showView == 'journal'">Oppgjørsbilag</a>
            </li>

        </ul>
    </div>
</header>

<create-corrected-vatreport-modal></create-corrected-vatreport-modal>
<historic-vatreport-modal (vatReportSelected)="historicVatReportSelected($event)"></historic-vatreport-modal>
<altinn-authentication-data-modal></altinn-authentication-data-modal>

<section class="application" [attr.aria-busy]="isBusy">

    <vatreport-checklist-view *ngIf="showView == 'control'"
                              [attr.aria-busy]="!reportMessages"
                              [vatReportMessages]="reportMessages"></vatreport-checklist-view>
    <vat-summary-per-post *ngIf="showView == ''"
                          [attr.aria-busy]="!reportSummaryPerPost"
                          [reportSummaryPerPost]="reportSummaryPerPost"
                          [period]="currentVatReport?.TerminPeriod"
                          [vatTypes]="vatTypes"
                          [isHistoricData]="isHistoricData">
    </vat-summary-per-post>
    <vatreport-receipt-view *ngIf="showView == 'receipt'"
                            [vatReport]="currentVatReport"
                            [reportSummaryPerPost]="reportSummaryPerPost"
                            (vatReportDidChange)="vatReportDidChange($event)">
    </vatreport-receipt-view>
    <vatreport-journal-entry *ngIf="showView == 'journal'"
                             [vatReport]="currentVatReport">
    </vatreport-journal-entry>
    <footer class="full-footer">
        <section class="application" *ngIf="actions">
            <uni-save [actions]="actions"></uni-save>
        </section>
    </footer>

    <div *ngIf="showView == ''" class="comment commentToSend">
        <label>Kommenter til Altinn</label>
        <textarea [formControl]="externalComment"
                  [ngModel]="currentVatReport.Comment"
                  [disabled]="currentVatReport?.ID == 0 || isSent()"></textarea>
    </div>

    <div *ngIf="showView == ''" class="comment internalComment">
        <label>Intern kommentar</label>
        <textarea [formControl]="internalComment"
                  [ngModel]="currentVatReport.InternalComment"
                  [disabled]="currentVatReport?.ID == 0"></textarea>
    </div>
</section>



