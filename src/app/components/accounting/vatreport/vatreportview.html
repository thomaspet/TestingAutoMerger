<header class="poster">
    <article class="poster_toolbar">
        <section>
            <h1>Termin {{currentVatReport?.TerminPeriod?.No}}</h1>
            <p>
                {{currentVatReport?.Title}}, {{currentVatReport?.TerminPeriod | periodDateFormat}} <span> , Status: {{ statusText }} </span>
            </p>
                <span *ngFor="let c of vatReportsInPeriod; let i=index">
                    <span *ngIf="i > 0">,   </span>
                    <a href="#/accounting/vatreports/{{c.ID}}">
                       {{c.Title}}
                    </a>
                </span>
        </section>
        <nav class="poster_toolbar_tools">
            <a (click)="onBackPeriod()" class="previous">Forrige</a>
            <a (click)="onForwardPeriod()" class="next">Neste</a>
            <uni-context-menu [actions]="contextMenuItems"></uni-context-menu>
        </nav>
    </article>

    <section class="poster_overview vatreportheader">

        <div class="poster_widgets">
            <dl class="poster_widget">
                <dt>Org.nraaa</dt>
                <dd>{{companySettings?.OrganizationNumber}}</dd>

                <dt>Navn</dt>
                <dd>{{companySettings?.CompanyName}}</dd>

                <dt>Kontonr. for tilbakebetaling</dt>
                <dd>{{companySettings?.CompanyBankAccount?.AccountNumber}}</dd>
            </dl>

            <article class="poster_widget tablewidget">
                <table>
                    <tr>
                        <th></th>
                        <th class="datacolumn">Grunnlag</th>
                        <th class="datacolumn">Avgift</th>
                    </tr>
                    <tr *ngFor="let summaryItem of vatReportSummary">
                        <td>{{summaryItem.VatCodeGroupName}}</td>
                        <td class="currency">
                            <a *ngIf="summaryItem.HasTaxBasis" href="#/accounting/transquery/details;vatCodes={{vatReportSummaryToVatCodes(summaryItem)}};vatFromDate={{currentVatReport?.TerminPeriod.FromDate}};vatToDate={{currentVatReport?.TerminPeriod.ToDate}}">
                                {{summaryItem.SumTaxBasisAmount * -1 | unicurrency:2}}
                            </a>
                        </td>
                        <td class="currency">
                            <a *ngIf="summaryItem.HasTaxAmount" href="#/accounting/transquery/details;vatCodes={{vatReportSummaryToVatCodes(summaryItem)}};vatFromDate={{currentVatReport?.TerminPeriod.FromDate}};vatToDate={{currentVatReport?.TerminPeriod.ToDate}}">
                                {{summaryItem.SumVatAmount * -1 | unicurrency:2}}
                            </a>
                        </td>
                    </tr>
                </table>
            </article>

            <article class="poster_widget">
                <ul class="statuslist">
                    <li [className]="isControlledWithoutWarnings() ? 'success' : 'warn'">
                        {{ isControlledWithoutWarnings() ? 'Automatisk kontroll ok' : 'Automatisk kontroll har advarsler' }}
                    </li>
                    <li [className]="isExecuted() ? 'success' : ''">
                        {{ isExecuted() ? 'Kjørt ok' : 'Ikke kjørt' }}
                    </li>
                    <li [className]="isSent() ? 'success' : ''">
                        {{ isSent() ? 'Sendt inn ok' : 'Ikke sendt inn' }}
                    </li>
                </ul>
            </article>

        </div>


    </section>
    <div class="horizontal_nav">
        <ul>
            <li>
                <a (click)="showView = 'control'" [class.router-link-active]="showView == 'control'">Kontroll</a>
            </li>
            <li>
                <a (click)="showView = ''" [class.router-link-active]="showView == ''">MVA-melding</a>
            </li>
            <li *ngIf="isSent()">
                <a (click)="showView = 'receipt'" [class.router-link-active]="showView == 'receipt'">Altinn, kvittering/tilbakemelding</a>
            </li>
            <li *ngIf="currentVatReport?.JournalEntryID">
                <a (click)="showView = 'journal'" [class.router-link-active]="showView == 'journal'">Oppgjørsbilag</a>
            </li>

        </ul>
    </div>
</header>

<create-corrected-vatreport-modal></create-corrected-vatreport-modal>
<historic-vatreport-modal (vatReportSelected)="historicVatReportSelected($event)"></historic-vatreport-modal>

<section class="application" [attr.aria-busy]="isBusy">

    <vatreport-checklist-view *ngIf="showView == 'control'"
                              [attr.aria-busy]="!reportMessages"
                              [vatReportMessages]="reportMessages"></vatreport-checklist-view>
    <vat-summary-per-post *ngIf="showView == ''"
                          [attr.aria-busy]="!reportSummaryPerPost"
                          [reportSummaryPerPost]="reportSummaryPerPost"
                          [period]="currentVatReport?.TerminPeriod"
                          [vatTypes]="vatTypes"></vat-summary-per-post>
    <vatreport-receipt-view 
                          *ngIf="showView == 'receipt'"
                          [vatReport]="currentVatReport"
                          [reportSummaryPerPost]="reportSummaryPerPost"
                          (vatreportDidChange)="currentVatReport = $event">
    </vatreport-receipt-view>
    <vatreport-journal-entry *ngIf="showView == 'journal'"
                             [vatReport]="currentVatReport">
    </vatreport-journal-entry>
    <footer class="full-footer">
        <section class="application" *ngIf="actions">
            <uni-save [actions]="actions"></uni-save>
        </section>
    </footer>

    <div class="comment commentToSend">
        <label>Kommenter til Altinn</label>
        <textarea [formControl]="externalComment"
                  [ngModel]="currentVatReport.Comment"
                  [disabled]="currentVatReport?.ID == 0 || isSent()"></textarea>
    </div>

    <div class="comment internalComment">
        <label>Intern kommentar</label>
        <textarea [formControl]="internalComment"
                  [ngModel]="currentVatReport.InternalComment"
                  [disabled]="currentVatReport?.ID == 0"></textarea>
    </div>
</section>



