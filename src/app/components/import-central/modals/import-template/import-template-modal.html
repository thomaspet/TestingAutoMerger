<section role="dialog" class="uni-modal uni-redesign">
    <header>
        {{options.header}}
    </header>
    <div class="under-line"></div>
    <article>
        <form class="uni-html-form">
            <label class="title">
                Klient
                <span class="value">
                    {{authService?.activeCompany?.Name}}
                </span>
            </label>

            <div class="external-details">
                <label class="title" *ngIf="options.data.hasTemplateAccess && options.data.isExternal">
                    Last ned mal
                    <span class="value">
                        <a
                            href="{{options.data.downloadTemplateUrl}}">{{options.data.downloadTemplateUrl.split("/").pop()}}</a>
                    </span>
                </label>
                <label class="statement">
                    {{options.data.conditionalStatement}}
                </label>
                <label class="statement">
                    {{options.data.formatStatement}}
                </label>
                <label class="statement">
                    {{options.data.downloadStatement}}
                </label>
                <label class="statement" *ngIf="options.data.isExternal">
                    Før du laster opp filen til Uni Economy, så vær vennlig og les gjennom våre vilkår. <a
                        (click)="openDisclaimerNote()">Vilkår.</a>
                </label>
            </div>

            <div class="dropdown-section" *ngIf="options.data.entity === payrollType && operators.length">
                <label class="title">Velg lønnsavregning</label>
                <label class="drop-down-container">
                    <uni-select class="drop-down" [config]="config" [value]="selectedPayroll" [items]="operators"
                        (valueChange)="onSelectChange($event)">
                    </uni-select>
                </label>
            </div>
            <div class="if-no-payroll" *ngIf="options.data.entity === payrollType && !operators.length">
                Det må opprettes en lønnsavregning før du kan importere variable lønnsposter.
                Trykk på link for å gå til <a [routerLink]="['/salary/payrollrun/0']"
                    (click)="close()">Lønnsavregning</a>.
            </div>
            <label class="title">
                Filopplasting
            </label>

            <div class="file-upload" [ngClass]="!isValidFileFormat ? 'error' : 'file-upload'" (click)="selectFile()"
                (drop)="dropFile($event)" (dragover)="dragFile($event)">
                <div class="upload-file" *ngIf='isFileSelected'>
                    <label class="uploaded-txt">Last opp filen</label>
                    <div class="file-card">
                        <i class="material-icons file-icon">insert_drive_file</i>
                        <label class="file-name">{{attachedFile.name}}</label>
                        <mat-progress-bar class="progress-bar" mode="determinate" [value]='progressBarVal'>
                        </mat-progress-bar>
                        <i class="material-icons cancel-icon" (click)="onFileDetach()" *ngIf="showCancel">add_circle</i>
                    </div>
                </div>
                <div class="select-file" *ngIf='!isFileSelected'>
                    <i class="material-icons">cloud_upload</i>
                    <span>
                        Dra og slipp eller <span class="browse-link">bla i</span> dine filer
                    </span>
                    <input #file type='file' (change)="openFile($event)" accept=".xlsx, .txt, .xml">
                </div>
            </div>
            <label class="error-msg" *ngIf='!isValidFileFormat'>
                Vennligst legg til en fil (.xlsx, .txt eller .xml) for å kunne importere {{options.data.type}}.
            </label>
            <div class="radio-button-group"
                *ngIf="(options.data.entity !== payrollType) && (options.data.entity !== saftType)">
                <mat-radio-group [(ngModel)]="importOption" [ngModelOptions]="{standalone: true}">
                    <mat-radio-button [value]="skip" [checked]="true"> <label class="option-text">Hopp over dupliserte
                            {{options.data.type}}</label></mat-radio-button>
                    <!-- <mat-radio-button [value]="duplicate"><label class="option-text">Opprett dupliserte
                            {{options.data.type}} med nye nummer</label>
                    </mat-radio-button> -->
                    <mat-radio-button [value]="override"><label class="option-text">Overskriv eksisterende
                            {{options.data.type}}</label></mat-radio-button>
                </mat-radio-group>
            </div>
            <div class="check-box-section" *ngIf="options.data.entity === saftType">
                <div>
                    <label class="title">Valg for import</label>
                    <label class="check-box-container">
                        <mat-checkbox class="check-box" [(ngModel)]="isOpening" [ngModelOptions]="{standalone: true}"
                            (click)="$event.stopPropagation()">
                        </mat-checkbox>
                        <label class="option-text">
                            Opprett åpningsbalanse
                        </label>
                    </label>
                </div>
                <div>
                    <label class="title"></label>
                    <label class="check-box-container">
                        <mat-checkbox class="check-box" [(ngModel)]="isKeepRecords"
                            [ngModelOptions]="{standalone: true}" (click)="$event.stopPropagation()">
                        </mat-checkbox>
                        <label class="option-text">
                            Behold kunde- og leverandørnummer
                        </label>
                    </label>
                </div>
                <div>
                    <label class="title"></label>
                    <label class="check-box-container">
                        <mat-checkbox class="check-box" [(ngModel)]="isUpdate" [ngModelOptions]="{standalone: true}"
                            (click)="$event.stopPropagation()">
                        </mat-checkbox>
                        <label class="option-text">
                            Oppdater eksisterende kunder/leverandører
                        </label>
                    </label>
                </div>
                <div>
                    <label class="title"></label>
                    <label class="check-box-container">
                        <mat-checkbox class="check-box" [(ngModel)]="isAutomatic" name='automatic'
                            [ngModelOptions]="{standalone: true}" (click)="$event.stopPropagation()">
                        </mat-checkbox>
                        <label class="option-text" for="automatic">
                            Automatisk merking av reskontroposter
                        </label>
                    </label>
                </div>
            </div>
        </form>

        <section *ngIf="loading$ | async" class="modal-spinner">
            <mat-spinner></mat-spinner>
        </section>

    </article>
    <footer class="center">
        <button class="c2a rounded" [disabled]="options.data.entity === payrollType && !operators.length || !selectedPayroll"
            (click)="importFile()">Importer {{options.data.type}}</button>
        <button (click)="close()">Avbryt</button>
    </footer>
</section>