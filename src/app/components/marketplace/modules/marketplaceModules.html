<section class="header">
    <h1>Produkter</h1>
    <a  *ngIf="priceListLink" class="price-list-link" [href]="priceListLink" target="_blank">
        <i class="material-icons">launch</i>
        Se priser
    </a>
</section>

<section class="marketplace-modules">

    <!-- Modules (if the contract-type selector is visible we show them with extensions instead) -->
    <section *ngIf="!contractTypes?.length" class="modules">
        <h2>Moduler</h2>
        <section class="product-card-grid">
            <section class="product-card" *ngFor="let module of modules">
                <section class="price-info">
                    <strong>{{module.Price}} kr</strong>
                    <span> {{priceText(module)}}</span>
                </section>

                <section class="product-info">
                    <img class="icon" [src]="module.IconReference" />
                    <span>{{module.Label}}</span>
                    <i *ngIf="module['_isBought']" class="material-icons purchase-indicator">check_circle</i>
                </section>

                <section class="subscribe">
                    <button
                        class="c2a subscribe-button"
                        (click)="manageUserPurchases(module)">
                        {{module['_isBought'] ? 'Velg brukere' : 'Abonner'}}
                    </button>
                </section>
                <a (click)="openSubscribeModal(module)" class="read-more">Les mer</a>
            </section>
        </section>
    </section>

    <!-- Contract-type selector -->
    <section class="contract-types" *ngIf="contractTypes?.length">
        <h2>Pakker</h2>
        <section class="product-card-grid">
            <contract-type-card
                *ngFor="let contractType of contractTypes"
                buttonClass="c2a"
                [contractType]="contractType"
                [disabled]="!contractType['_isValidUpgrade']"
                [disabledReason]="contractType['_disabledReason']"
                [active]="contractType['_isActive']"
                [recommended]="contractType['_isValidUpgrade'] && contractType.Name === 'Plus' && isBrunoEnv"
                (selected)="changeContractType(contractType)">
            </contract-type-card>
        </section>
    </section>

    <ng-container *ngIf="contractTypes?.length">
        <contract-types-comparison style="width: 100%; margin: 0 auto"></contract-types-comparison>
    </ng-container>

    <!-- Expensions (and modules if the contract-type selector is visible) -->
    <section *ngIf="extensions?.length || (contractTypes?.length && modules?.length)" class="extensions">
        <h2>Utvidelser</h2>

        <section class="product-card-grid">
            <ng-container *ngIf="contractTypes?.length">
                <section class="product-card" *ngFor="let module of modules">
                    <section class="price-info">
                        <strong>{{module.Price}} kr</strong>
                        <span> {{priceText(module)}}</span>
                    </section>

                    <section class="product-info">
                        <img class="icon" [src]="module.IconReference" />
                        <span>{{module.Label}}</span>
                        <i *ngIf="module['_isBought']" class="material-icons purchase-indicator">check_circle</i>
                    </section>

                    <section class="subscribe">
                        <button
                            class="c2a subscribe-button"
                            (click)="manageUserPurchases(module)">
                            {{module['_isBought'] ? 'Rediger brukere' : 'Aktiver'}}
                        </button>
                    </section>

                    <a (click)="openSubscribeModal(module)" class="read-more">Les mer</a>
                </section>
            </ng-container>

            <section class="product-card" *ngFor="let extension of extensions"> <!-- *ngFor="let extension of filteredExtensions" -->
                <section class="price-info">
                    <strong>{{extension.Price}} kr</strong>
                    <span> {{priceText(extension)}}</span>
                </section>

                <section class="product-info">
                    <img class="icon" [src]="extension.IconReference" />
                    <span>{{extension.Label}}</span>
                    <i
                        *ngIf="extension['_isBought'] && !extension['_activationFunction']"
                        class="material-icons purchase-indicator">
                        check_circle
                    </i>
                    <i
                        *ngIf="extension['_isBought'] && extension['_activationFunction']"
                        class="material-icons purchase-indicator"
                        style="color: #F5A623 !important"
                        title="Utvidelsen er kjÃ¸pt, men ikke aktivert">
                        warning
                    </i>
                </section>

                <section class="subscribe">
                    <!-- Buy -->
                    <button
                        class="c2a subscribe-button"
                        *ngIf="!extension['_isBought']"
                        (click)="purchaseExtension(extension)">
                        Aktiver
                    </button>

                    <!-- Activate -->
                    <button
                        class="c2a subscribe-button"
                        *ngIf="extension['_isBought'] && extension['_activationFunction']"
                        (click)="extension['_activationFunction'].click()">
                        {{extension['_activationFunction']?.label}}
                    </button>
                </section>

                <a (click)="openSubscribeModal(extension)" class="read-more">Les mer</a>
            </section>
        </section>

    </section>
</section>
