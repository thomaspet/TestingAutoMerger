<uni-toolbar class="no-print" [config]="toolbarConfig" [saveactions]="actions"></uni-toolbar>

<aside class="horizontal_nav no-print">
    <ul>
        <li *ngFor="let tab of tabs">
            <a (click)="onTabClick(tab)" [ngClass]="{'router-link-active': tab.isSelected}">
                {{tab.label}}
                <span class='tab_counter' *ngIf="tab.counter">{{tab.counter}}</span>
            </a>
        </li>
    </ul>
</aside>

<section class='application regtimecontainer'>

    <section class="regtime_tabs">

        <section [hidden]="!tabs[1].isSelected">
            <regtimetools></regtimetools>
        </section>

        <section [hidden]="!tabs[2].isSelected">
            <regtimetotals></regtimetotals>
        </section>

        <section [hidden]="!tabs[3].isSelected">
            <h2>Timesaldo - <span *ngIf="currentBalance && currentBalance.WorkRelation">{{currentBalance.WorkRelation.Description}} - {{currentBalance.WorkRelation.WorkPercentage}}% stilling</span></h2>
            <article *ngIf="currentBalance && currentBalance.WorkRelation">

                <h3 *ngIf="currentBalance.relationIsClosed">
                    Fra {{currentBalance.BalanceFrom | date:'dd.MM.yyyy'}}
                    <div class="bad">Stillingen har sluttdato: {{currentBalance.WorkRelation.EndTime | date: 'dd.MM.yyyy'}}</div>
                </h3>
                
                <h3 *ngIf="!currentBalance.relationIsClosed">
                    Fra {{currentBalance.BalanceFrom | date:'dd.MM.yyyy'}} til {{currentBalance.BalanceDate | date:'dd.MM.yyyy'}}
                </h3>

                <table class="flex-table">
                    <tbody>
                        <tr>
                            <td class="label">Forventet antall timer</td><td class="sum">{{currentBalance.expectedHours}}</td>
                            
                            <td class="spacer"></td>
                            <td class="label">Forventet i dag</td><td class="sum">{{currentBalance.LastDayExpected|min2hours:'decimal'}}</td>                            
                        </tr>
                        <tr>
                            <td class="label">Timer levert</td><td class="sum">{{currentBalance.actualHours}}</td>
                            
                            <td class="spacer"></td>
                            <td class="label">Timer i dag</td><td class="sum">{{currentBalance.LastDayActual|min2hours:'decimal'}}</td>
                        </tr>
                        <tr>
                            <td class="label grandtotal">Saldo i timer</td>
                            <td class="sum grandtotal">{{currentBalance.hours}}</td>
                            <td class="spacer"></td>
                            <td class="label grandtotal">Saldo for i dag</td><td class="sum grandtotal">{{currentBalance.lastDayBalanceHours}}</td>
                        </tr>
                    </tbody>
                </table>

                <h3 *ngIf="currentBalance && currentBalance.SumOvertime">
                    <div class="bad">Sum overtid: {{currentBalance.SumOvertime|min2hours:'decimal'}} timer</div>
                </h3>


                <br/>
                <h3>Planlagt fri i perioden</h3>
                <table class="flex-table">
                    <tbody>
                        <tr>
                            <td class="label">Gyldig fravær/fri</td><td class="sum">{{currentBalance.ValidTimeOff|min2hours:'decimal'}}</td>
                            <td>{{currentBalance.Description}}</td>
                        </tr>
                    </tbody>
                </table>                
            </article>
        </section>


        <section [hidden]="!tabs[4].isSelected">
            <vacation *ngIf="tabs[4].activated" (saved)="onVacationSaved()" [workrelationid]="timeSheet.currentRelation.ID"></vacation>
        </section>

        <!--
        
        <section [hidden]="!tabs[3].isSelected">
            <h2>Arbeidsgivere</h2>
        </section>


        <section [hidden]="!tabs[5].isSelected">
            <h2>Fravær</h2>
        </section>
        -->

        <section [hidden]="!tabs[0].isSelected">

            <aside class="regtime_filters no-print">

                <footer>
                    <table class='timeentry_toolbar'><tr>
                    <td>
                        <button class="good" (click)="onAddNew()">Ny timeføring</button>
                        <button *ngIf="hasUnsavedChanges()" class="good" (click)="save()">Lagre endringer</button>
                        <button *ngIf="hasUnsavedChanges()" class="bad" (click)="reset()">Avbryt</button>
                    </td>                    
                    <td>
                        <span [hidden]="!filters[0].isSelected" *ngIf="currentBalance && currentBalance.LastDayExpected">
                            Forventet i dag: {{currentBalance.LastDayExpected | min2hours}}
                        </span>
                    </td>
                    <td [hidden]="!(timeSheet && timeSheet.totals.Minutes)">                        
                        Totalsum: {{timeSheet.totals.Minutes | min2hours}}
                    </td>
                    </tr></table>
                </footer>

                <ul>
                    <li *ngFor="let filter of filters">
                        <a (click)="onFilterClick(filter)" [ngClass]="{'router-link-active': filter.isSelected}" >{{filter.label}}</a>
                    </li>
                </ul>

            </aside>

            <article [attr.aria-busy]="busy" >

                <aside class='busy' *ngIf='busy'>Vent litt... stiller klokker og spisser blyanter..</aside>

                <table class='timeentriesTable' editable [config]="tableConfig" >
                    <thead>
                        <tr>
                            <th class='s2'>Dato</th>
                            <th class='s1'>Start</th>
                            <th class='s1'>Slutt</th>
                            <th class='s3'>Timeart</th>
                            <th class='s1'>Lunsj</th>
                            <th class='s4'>Beskrivelse</th>
                            <th class='s3'>Prosjekt</th>
                            <th class='s3'>Ordrenr.</th>
                            <th class='s1'> </th>
                        </tr>
                    </thead>
                    <tbody *ngIf="timeSheet.currentRelation">
                        <tr *ngFor="let item of timeSheet.items; let i=index" [class.alternateRow]="item._alternate">
                            <td >{{item.Date | isotime:'DD.MM.YYYY'}}</td>
                            <td>{{item.StartTime | isotime:'HH:mm'}}</td>
                            <td>{{item.EndTime | isotime:'HH:mm'}}</td>
                            <td>{{item.Worktype ? item.Worktype.ID + ' - ' + item.Worktype.Name : ''}}</td>
                            <td>{{item.LunchInMinutes}}</td>
                            <td>{{item.Description}}</td>
                            <td>{{item.Dimensions ? (item.Dimensions.Project ? (item.Dimensions.Project.ProjectNumber + ' - ' + item.Dimensions.Project.Name) : item.Dimensions.ProjectID) : ''}}</td>
                            <td>{{item.CustomerOrder ? item.CustomerOrder.OrderNumber + ' - ' + item.CustomerOrder.CustomerName : item.CustomerOrderID }}</td>
                            <td class='timeSheet_actions'><button (click)="onRowActionClicked(i, item)"></button></td>
                        </tr>
                    </tbody>
                </table>
            </article>

        </section>

    </section>

</section>

<uni-confirm-modal></uni-confirm-modal>