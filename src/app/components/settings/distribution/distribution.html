﻿<uni-toolbar [config]="toolbarConfig"></uni-toolbar>

<section class="distribution-container container-for-spinner">

    <uni-tabs
        [tabs]="tabs"
        [(activeIndex)]="activeIndex"
        (tabClick)="updateTabAndUrl()">
    </uni-tabs>

    <section *ngIf="busy" class="modal-spinner">
        <mat-spinner class="c2a"></mat-spinner>
    </section>

    <section style="background-color: white; padding: 2rem;">
        <header class="distribution-header-section">
            <span class="title"> Utsendelse </span>
            <span class="auto-slider-title" *ngIf="type?.value === 'Models.Sales.CustomerInvoice'"> Slå på automatisk bruk av utsendelsesplan for faktura </span>
            <mat-slide-toggle [(ngModel)]="active" (change)="turnOnOffAutomaticDistribution()" *ngIf="type.value === 'Models.Sales.CustomerInvoice'" ></mat-slide-toggle>
        </header>

        <section>
            <section *ngIf="!hideDistributionInfo" class="alert info">
                <i class="material-icons">info</i>
                <span>
                    Her kan du lage en plan for hvordan systemet skal sende ut faktura. I oppsettet velger du utsendelsesmetoder som du vil ha som førstevalg, andrevalg, opp til femtevalg. Kan ikke kunden ta imot ditt oppsatte førstevalg vil systemet prøve å sende på andrevalget osv.
                    <a (click)="openLearnModal()">Lær mer om oppsett av utsendelsesplaner her</a>
                </span>
                <i class="material-icons close-icon" (click)="hideInfo()">close</i>
            </section>
        </section>

        <div class="plans-info-container" *ngIf="type?.plans?.length">
            <simple-table>
                <thead>
                    <tr>
                        <th> Navn </th>
                        <th> Prioriteringsrekkefølge </th>
                        <th> Tildelt til </th>
                        <th>  </th>
                    </tr>
                </thead>

                <tbody>
                    <tr *ngFor="let plan of type.plans">
                        <td class="plan-name"> {{ plan.Name }} </td>
                        <td>
                            <ul class="distribution-elements-stepper" style="margin: 0;">
                                <ng-container *ngFor="let elem of plan.Elements; let i = index;">
                                    <li class="list-item"> {{ elem.Priority }}. {{ elem.ElementType._label }} </li>
                                    <li class="divider" *ngIf="i < plan.Elements.length - 1"></li>
                                </ng-container>
                            </ul>
                        </td>
                        <td> <a (click)="onActionClick('customer', plan, type)"> {{ plan._count || 0 }} kunder </a> </td>
                        <td>
                            <span *ngIf="type.defaultPlan && type.defaultPlan.ID === plan.ID"> Firmastandard </span>
                            <i #toggle class="material-icons">more_horiz</i>
                            <dropdown-menu [trigger]="toggle">
                                <ng-template>
                                    <section class="dropdown-menu-item" (click)="onActionClick('customer', plan, type)">
                                        Administrer kunder
                                    </section>

                                    <section class="dropdown-menu-item" (click)="onActionClick('edit', plan, type)">
                                        Rediger
                                    </section>

                                    <section class="dropdown-menu-item" (click)="onActionClick('delete', plan, type)">
                                        Slett
                                    </section>

                                    <section class="dropdown-menu-item" (click)="onActionClick('standard', plan, type)"
                                        *ngIf="!type.defaultPlan || plan.ID !== type.defaultPlan.ID">
                                        Sett som standard
                                    </section>
                                </ng-template>
                            </dropdown-menu>
                        </td>
                    </tr>
                </tbody>

            </simple-table>

            <button class="add-button secondary c2a" (click)="openPlanModal(null, type)">
                Opprett ny utsendelsesplan
            </button>
        </div>
        <section *ngIf="!type?.plans?.length && loaded" class="no-plans-container">
            <img [src]="defaultImageUrl" alt="Illustration indicating missing widget data" />

            <section>
                <span> Du har ikke satt opp noen utsendelsesplan </span>
                <button class="c2a" (click)="openPlanModal(null, type)"> Opprett ny utsendelsesplan </button>
            </section>
        </section>
    </section>
</section>
