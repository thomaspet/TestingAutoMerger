<section class="background" [ngStyle]="{'background': background, 'height': backgroundHeight}"></section>

<section class="content">
    <section class="illustration-wrapper">
        <img *ngIf="illustration" [src]="illustration">
    </section>

    <article class="authentication-component">
        <h1>{{headerText}}</h1>

        <small class="alert error" *ngIf="errorMessage">
            {{errorMessage}}
        </small>

        <!-- STEP 1 -->
        <section class="signup-step" *ngIf="!confirmationCode">
            <!-- <section *ngIf="!step1Successful && !errorMessage" class="init-subtitle">
                Registrer deg her og få tilgang til en 30 dagers prøveperiode.
            </section> -->

            <section class="init-subtitle" *ngIf="step1Successful">
                En e-post med mer informasjon er sendt til {{step1Form.controls['Email'].value}}.
                <br>Sjekk gjerne søppelpostkassen dersom du ikke har mottatt noe i løpet av kort tid.
            </section>

            <ng-container *ngIf="!step1Successful">
                <form [formGroup]="step1Form">
                    <label class="uni-label">
                        <span>Ditt navn</span>
                        <input type="text" formControlName="DisplayName" />
                    </label>

                    <label class="uni-label">
                        <span>E-post</span>
                        <input type="email" formControlName="Email" />
                    </label>

                    <label class="uni-label">
                        <span>Telefon</span>
                        <input type="tel" formControlName="PhoneNumber" />
                    </label>
                </form>

                <section class="agreement-text">
                    {{agreeementText}}
                </section>

                <section class="recaptcha-wrapper">
                    <uni-recaptcha (reCaptchaCode)="recaptchaCode = $event"></uni-recaptcha>
                </section>

                <button
                    class="c2a"
                    (click)="submitStep1Form()"
                    [attr.aria-busy]="busy"
                    [disabled]="busy || !step1Form?.valid || !recaptchaCode">
                    Start registrering
                </button>

                <section class="login-link">
                    Har du allerede en bruker?
                    <a [routerLink]="['/init/login']">Logg inn</a>
                </section>
            </ng-container>
        </section>

        <!-- STEP 2  -->
        <section class="signup-step" *ngIf="confirmationCode">
            <section class="init-subtitle" *ngIf="!step2Successful && !errorMessage">
                Vennligst fyll ut ønsket passord for denne brukeren
            </section>

            <ng-container *ngIf="step2Successful && !errorMessage">
                <section class="init-subtitle">
                    <!-- Brukerregistrering er nå fullført og du er snart i mål! -->
                    Prøveperioden på 30 dager er nå aktiv og alt er klart for
                    å registrere bedriften din i {{appName}}.
                </section>

                <!-- <p style="font-size: 15px">
                    Prøveperioden på 30 dager er nå aktiv og alt er klart for
                    å registrere bedriften din.
                    Logg inn med brukeren du nettopp har opprettet, så hjelper vi deg
                    videre derfra.
                </p> -->

                <button class="c2a" style="margin: 1rem auto" (click)="authenticateAfterSignup()">
                    Logg inn
                </button>
            </ng-container>

            <ng-container *ngIf="!step2Successful && !invalidConfirmationCode && !userExists">
                <form #step2="ngForm" [formGroup]="step2Form">
                    <label class="uni-label">
                        <span>Skriv inn ønsket passord</span>
                        <input type="password" formControlName="Password" autocomplete="new-password" />
                    </label>

                    <uni-password-guide *ngIf="step2Form?.controls"
                        [passwordControl]="step2Form.controls.Password">
                    </uni-password-guide>

                    <label class="uni-label">
                        <span>Bekreft passord</span>
                        <input type="password" formControlName="ConfirmPassword" (keydown.enter)="submitStep2Form()" />
                        <small class="bad">{{step2Form?.get('ConfirmPassword').errors?.passwordMatchValidator}}</small>
                    </label>
                </form>

                <section class="button-row">
                    <button routerLink="/init/sign-up" class="secondary">Avbryt</button>
                    <button
                        (click)="submitStep2Form()"
                        class="c2a"
                        [attr.aria-busy]="busy"
                        [disabled]="busy || !step2Form?.valid">
                        Fullfør registrering
                    </button>
                </section>
            </ng-container>
        </section>

        <a class="init-link" *ngIf="invalidConfirmationCode"
            [routerLink]="['/init/sign-up']"
            (click)="invalidConfirmationCode = false">
            Tilbake til registrering
        </a>
    </article>
</section>

